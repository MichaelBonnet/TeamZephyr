import nmap
from pymetasploit3.msfrpc import *
import time
import numpy
#from nmap_scanner import *

# initialize the port scanner
target_info = []
os = ['linux', 'windows', 'unix']

'''
target_info's index information:
0 = port
1 = state
2 = name
3 = product
4 = version
5 = additional info
6 = common platform enumeration
7 = ip
'''

exploits = []                                                       

# Populates the exploits[] list with the device/service names
# from target_info[], which itself was populated by
# get_target_info() from targets.txt
# in the future, this will also use that exploits[] list to inform
# an automated search of metasploit for each exploitable device/service.
def search_exploits(obj):
	rows = len(target_info)
	for i in obj:
		for j in range(rows):
			if target_info[j][3] in i:
				if target_info[j][3] in i:
					exploits.append(i) #TODO : implement OS exploitation detection

# Opens targets.txt then populates the target_info[] list
# with lists where each one contains 
# a device's/service's nmap-scan-generated info
def get_target_info():
	fp = open("targets.txt", "r")
	lines = fp.readlines()
	for line in lines:
	    word = line.split(' , ')
	    global target_info
	    target_info.append(word)


'''
Main function (program begins here)
'''
if __name__ == '__main__':
	client = MsfRpcClient(password='password', ip='127.0.0.1')
	obj = client.modules.exploits
	get_target_info()
	print(target_info)

	search_exploits(obj)
	if not exploits:
		print('No exploits found!')
	print('Here is the list of exploits that can be used:')
	print(exploits)

	
